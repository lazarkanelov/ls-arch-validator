{
  "main_tf": "# Microservices Architecture (from diagram)\n\nresource \"aws_ecs_cluster\" \"main\" {\n  name = \"microservices-cluster\"\n\n  setting {\n    name  = \"containerInsights\"\n    value = \"enabled\"\n  }\n}\n\nresource \"aws_ecs_task_definition\" \"api\" {\n  family                   = \"api-service\"\n  network_mode             = \"awsvpc\"\n  requires_compatibilities = [\"FARGATE\"]\n  cpu                      = 256\n  memory                   = 512\n  execution_role_arn       = aws_iam_role.ecs_execution.arn\n\n  container_definitions = jsonencode([{\n    name  = \"api\"\n    image = \"api-service:latest\"\n    portMappings = [{\n      containerPort = 8080\n      protocol      = \"tcp\"\n    }]\n    environment = [\n      { name = \"DB_HOST\", value = aws_db_instance.main.endpoint }\n    ]\n  }])\n}\n\nresource \"aws_lb\" \"api\" {\n  name               = \"api-lb\"\n  internal           = false\n  load_balancer_type = \"application\"\n  subnets            = aws_subnet.public[*].id\n  security_groups    = [aws_security_group.alb.id]\n}\n\nresource \"aws_db_instance\" \"main\" {\n  identifier        = \"microservices-db\"\n  engine            = \"postgres\"\n  engine_version    = \"14\"\n  instance_class    = \"db.t3.micro\"\n  allocated_storage = 20\n  db_name           = \"appdb\"\n  username          = var.db_username\n  password          = var.db_password\n}\n",
  "variables_tf": null,
  "outputs_tf": null
}