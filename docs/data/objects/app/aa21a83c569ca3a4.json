{
  "probe_type": "integration",
  "probe_name": "ECS-ALB-RDS Integration Probe",
  "probed_features": [
    "alb_target_groups",
    "health_checks",
    "rds_connectivity",
    "service_discovery"
  ],
  "source_files": {
    "src/probes/ecs_integration.py": "\"\"\"ECS-ALB-RDS Integration Probe.\"\"\"\nfrom __future__ import annotations\n\nimport boto3\nimport os\nfrom dataclasses import dataclass\nfrom typing import Optional\n\n\n@dataclass\nclass ProbeResult:\n    feature: str\n    expected: str\n    actual: str\n    passed: bool\n    error: Optional[str] = None\n\n\nclass ECSIntegrationProbe:\n    \"\"\"Tests ECS-ALB-RDS integration.\"\"\"\n    \n    def __init__(self):\n        endpoint = os.getenv('AWS_ENDPOINT_URL', 'http://localhost:4566')\n        self.elbv2 = boto3.client('elbv2', endpoint_url=endpoint, region_name='us-east-1')\n        self.rds = boto3.client('rds', endpoint_url=endpoint, region_name='us-east-1')\n        self.ecs = boto3.client('ecs', endpoint_url=endpoint, region_name='us-east-1')\n    \n    def test_alb_target_group(self) -> ProbeResult:\n        \"\"\"Test ALB target group with IP targets (for Fargate).\"\"\"\n        try:\n            response = self.elbv2.create_target_group(\n                Name='ecs-targets',\n                Protocol='HTTP',\n                Port=80,\n                VpcId='vpc-12345',\n                TargetType='ip',\n                HealthCheckPath='/health',\n                HealthCheckIntervalSeconds=30,\n            )\n            tg = response['TargetGroups'][0]\n            return ProbeResult(\n                feature='alb_target_groups',\n                expected='IP target group created',\n                actual=f'Target group {tg[\"TargetGroupName\"]} created',\n                passed=True,\n            )\n        except Exception as e:\n            return ProbeResult(\n                feature='alb_target_groups',\n                expected='Target group created',\n                actual=str(e),\n                passed=False,\n                error=str(e),\n            )\n    \n    def test_alb_health_check(self) -> ProbeResult:\n        \"\"\"Test ALB health check configuration.\"\"\"\n        try:\n            # Modify health check on existing target group\n            self.elbv2.modify_target_group(\n                TargetGroupArn='arn:aws:elasticloadbalancing:us-east-1:000000000000:targetgroup/ecs-targets/12345',\n                HealthCheckPath='/health',\n                HealthCheckIntervalSeconds=15,\n                HealthyThresholdCount=2,\n                UnhealthyThresholdCount=3,\n            )\n            return ProbeResult(\n                feature='health_checks',\n                expected='Health check configured',\n                actual='Health check settings updated',\n                passed=True,\n            )\n        except Exception as e:\n            # Expected to fail if target group doesn't exist\n            return ProbeResult(\n                feature='health_checks',\n                expected='Health check configured',\n                actual=str(e)[:100],\n                passed='TargetGroupNotFound' not in str(e),\n                error=str(e),\n            )\n    \n    def test_rds_postgres_connection(self) -> ProbeResult:\n        \"\"\"Test RDS PostgreSQL instance creation.\"\"\"\n        try:\n            response = self.rds.describe_db_instances()\n            instances = response.get('DBInstances', [])\n            postgres_instances = [i for i in instances if i.get('Engine') == 'postgres']\n            return ProbeResult(\n                feature='rds_connectivity',\n                expected='PostgreSQL instance available',\n                actual=f'{len(postgres_instances)} PostgreSQL instances found',\n                passed=len(postgres_instances) > 0,\n            )\n        except Exception as e:\n            return ProbeResult(\n                feature='rds_connectivity',\n                expected='RDS accessible',\n                actual=str(e),\n                passed=False,\n                error=str(e),\n            )\n    \n    def run_all_probes(self) -> list[ProbeResult]:\n        return [\n            self.test_alb_target_group(),\n            self.test_alb_health_check(),\n            self.test_rds_postgres_connection(),\n        ]\n"
  },
  "test_files": {
    "tests/test_ecs_integration.py": "\"\"\"Tests for ECS-ALB-RDS integration.\"\"\"\nimport pytest\nfrom src.probes.ecs_integration import ECSIntegrationProbe\n\n\nclass TestECSIntegration:\n    @pytest.fixture\n    def probe(self):\n        return ECSIntegrationProbe()\n    \n    def test_alb_target_group(self, probe):\n        result = probe.test_alb_target_group()\n        assert result.passed, f\"ALB target group failed: {result.error}\"\n    \n    def test_health_check(self, probe):\n        result = probe.test_alb_health_check()\n        assert result.passed, f\"Health check failed: {result.error}\"\n    \n    def test_rds_connectivity(self, probe):\n        result = probe.test_rds_postgres_connection()\n        assert result.passed, f\"RDS connectivity failed: {result.error}\"\n"
  },
  "requirements": [
    "boto3>=1.28.0",
    "pytest>=7.0.0"
  ]
}