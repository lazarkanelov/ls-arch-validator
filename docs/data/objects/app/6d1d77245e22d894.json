{
  "probe_type": "api_parity",
  "probe_name": "ECS/Fargate API Parity Probe",
  "probed_features": [
    "awsvpc_networking",
    "cluster_management",
    "container_insights",
    "service_deployment",
    "task_definitions"
  ],
  "source_files": {
    "src/probes/ecs_parity.py": "\"\"\"ECS/Fargate API Parity Probe for LocalStack.\"\"\"\nfrom __future__ import annotations\n\nimport boto3\nimport os\nfrom dataclasses import dataclass\nfrom typing import Optional\n\n\n@dataclass\nclass ProbeResult:\n    feature: str\n    expected: str\n    actual: str\n    passed: bool\n    error: Optional[str] = None\n\n\nclass ECSParityProbe:\n    \"\"\"Tests ECS/Fargate API parity with AWS.\"\"\"\n    \n    def __init__(self):\n        endpoint = os.getenv('AWS_ENDPOINT_URL', 'http://localhost:4566')\n        self.ecs = boto3.client('ecs', endpoint_url=endpoint, region_name='us-east-1')\n    \n    def test_cluster_creation(self) -> ProbeResult:\n        \"\"\"Test ECS cluster creation with settings.\"\"\"\n        try:\n            response = self.ecs.create_cluster(\n                clusterName='test-cluster',\n                settings=[{'name': 'containerInsights', 'value': 'enabled'}],\n                capacityProviders=['FARGATE', 'FARGATE_SPOT']\n            )\n            cluster = response['cluster']\n            return ProbeResult(\n                feature='cluster_management',\n                expected='Cluster created with settings',\n                actual=f'Cluster {cluster[\"clusterName\"]} status: {cluster[\"status\"]}',\n                passed=cluster['status'] == 'ACTIVE',\n            )\n        except Exception as e:\n            return ProbeResult(\n                feature='cluster_management',\n                expected='Cluster created',\n                actual=str(e),\n                passed=False,\n                error=str(e),\n            )\n    \n    def test_task_definition_registration(self) -> ProbeResult:\n        \"\"\"Test Fargate task definition with awsvpc mode.\"\"\"\n        try:\n            response = self.ecs.register_task_definition(\n                family='test-task',\n                networkMode='awsvpc',\n                requiresCompatibilities=['FARGATE'],\n                cpu='256',\n                memory='512',\n                containerDefinitions=[{\n                    'name': 'app',\n                    'image': 'nginx:latest',\n                    'portMappings': [{'containerPort': 80, 'protocol': 'tcp'}],\n                    'essential': True,\n                }]\n            )\n            task_def = response['taskDefinition']\n            return ProbeResult(\n                feature='task_definitions',\n                expected='Task registered with Fargate',\n                actual=f'Task {task_def[\"family\"]}:{task_def[\"revision\"]} registered',\n                passed=task_def['status'] == 'ACTIVE',\n            )\n        except Exception as e:\n            return ProbeResult(\n                feature='task_definitions',\n                expected='Task definition registered',\n                actual=str(e),\n                passed=False,\n                error=str(e),\n            )\n    \n    def test_service_deployment(self) -> ProbeResult:\n        \"\"\"Test ECS service creation with Fargate.\"\"\"\n        try:\n            response = self.ecs.create_service(\n                cluster='test-cluster',\n                serviceName='test-service',\n                taskDefinition='test-task',\n                desiredCount=1,\n                launchType='FARGATE',\n                networkConfiguration={\n                    'awsvpcConfiguration': {\n                        'subnets': ['subnet-12345'],\n                        'securityGroups': ['sg-12345'],\n                        'assignPublicIp': 'ENABLED'\n                    }\n                }\n            )\n            service = response['service']\n            return ProbeResult(\n                feature='service_deployment',\n                expected='Service created',\n                actual=f'Service {service[\"serviceName\"]} status: {service[\"status\"]}',\n                passed=service['status'] == 'ACTIVE',\n            )\n        except Exception as e:\n            return ProbeResult(\n                feature='service_deployment',\n                expected='Service deployed',\n                actual=str(e),\n                passed=False,\n                error=str(e),\n            )\n    \n    def run_all_probes(self) -> list[ProbeResult]:\n        return [\n            self.test_cluster_creation(),\n            self.test_task_definition_registration(),\n            self.test_service_deployment(),\n        ]\n"
  },
  "test_files": {
    "tests/test_ecs_parity.py": "\"\"\"Tests for ECS/Fargate API parity.\"\"\"\nimport pytest\nfrom src.probes.ecs_parity import ECSParityProbe\n\n\nclass TestECSParity:\n    @pytest.fixture\n    def probe(self):\n        return ECSParityProbe()\n    \n    def test_cluster_creation(self, probe):\n        result = probe.test_cluster_creation()\n        assert result.passed, f\"Cluster creation failed: {result.error}\"\n    \n    def test_task_definition(self, probe):\n        result = probe.test_task_definition_registration()\n        assert result.passed, f\"Task definition failed: {result.error}\"\n    \n    def test_service_deployment(self, probe):\n        result = probe.test_service_deployment()\n        assert result.passed, f\"Service deployment failed: {result.error}\"\n"
  },
  "requirements": [
    "boto3>=1.28.0",
    "pytest>=7.0.0"
  ]
}