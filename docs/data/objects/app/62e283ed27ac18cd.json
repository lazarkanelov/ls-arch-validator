{
  "probe_type": "api_parity",
  "probe_name": "S3 API Parity Probe",
  "probed_features": [
    "bucket_notifications",
    "lifecycle_rules",
    "multipart_upload",
    "object_versioning",
    "presigned_urls"
  ],
  "source_files": {
    "src/probes/s3_parity.py": "\"\"\"S3 API Parity Probe for LocalStack.\"\"\"\nfrom __future__ import annotations\n\nimport boto3\nimport os\nfrom dataclasses import dataclass\nfrom typing import Optional\n\n\n@dataclass\nclass ProbeResult:\n    feature: str\n    expected: str\n    actual: str\n    passed: bool\n    error: Optional[str] = None\n\n\nclass S3ParityProbe:\n    \"\"\"Tests S3 API parity with AWS.\"\"\"\n    \n    def __init__(self):\n        endpoint = os.getenv('AWS_ENDPOINT_URL', 'http://localhost:4566')\n        self.s3 = boto3.client('s3', endpoint_url=endpoint, region_name='us-east-1')\n        self.bucket = 'test-uploads'\n    \n    def test_bucket_notifications(self) -> ProbeResult:\n        \"\"\"Test S3 bucket notification configuration.\"\"\"\n        try:\n            config = {\n                'LambdaFunctionConfigurations': [{\n                    'LambdaFunctionArn': 'arn:aws:lambda:us-east-1:000000000000:function:test',\n                    'Events': ['s3:ObjectCreated:*'],\n                    'Filter': {'Key': {'FilterRules': [{'Name': 'prefix', 'Value': 'uploads/'}]}}\n                }]\n            }\n            self.s3.put_bucket_notification_configuration(Bucket=self.bucket, NotificationConfiguration=config)\n            result = self.s3.get_bucket_notification_configuration(Bucket=self.bucket)\n            has_lambda = len(result.get('LambdaFunctionConfigurations', [])) > 0\n            return ProbeResult(\n                feature='bucket_notifications',\n                expected='Lambda notification configured',\n                actual=f'{len(result.get(\"LambdaFunctionConfigurations\", []))} Lambda configs',\n                passed=has_lambda,\n            )\n        except Exception as e:\n            return ProbeResult(\n                feature='bucket_notifications',\n                expected='Notification configured',\n                actual=str(e),\n                passed=False,\n                error=str(e),\n            )\n    \n    def test_object_versioning(self) -> ProbeResult:\n        \"\"\"Test S3 object versioning.\"\"\"\n        try:\n            self.s3.put_bucket_versioning(Bucket=self.bucket, VersioningConfiguration={'Status': 'Enabled'})\n            self.s3.put_object(Bucket=self.bucket, Key='versioned.txt', Body=b'v1')\n            self.s3.put_object(Bucket=self.bucket, Key='versioned.txt', Body=b'v2')\n            versions = self.s3.list_object_versions(Bucket=self.bucket, Prefix='versioned.txt')\n            version_count = len(versions.get('Versions', []))\n            return ProbeResult(\n                feature='object_versioning',\n                expected='2 versions',\n                actual=f'{version_count} versions',\n                passed=version_count >= 2,\n            )\n        except Exception as e:\n            return ProbeResult(\n                feature='object_versioning',\n                expected='Versioning works',\n                actual=str(e),\n                passed=False,\n                error=str(e),\n            )\n    \n    def test_presigned_url(self) -> ProbeResult:\n        \"\"\"Test presigned URL generation.\"\"\"\n        try:\n            self.s3.put_object(Bucket=self.bucket, Key='presigned-test.txt', Body=b'test')\n            url = self.s3.generate_presigned_url(\n                'get_object',\n                Params={'Bucket': self.bucket, 'Key': 'presigned-test.txt'},\n                ExpiresIn=3600\n            )\n            return ProbeResult(\n                feature='presigned_urls',\n                expected='Valid presigned URL',\n                actual=f'URL generated: {url[:50]}...',\n                passed='X-Amz-Signature' in url or 'Signature' in url,\n            )\n        except Exception as e:\n            return ProbeResult(\n                feature='presigned_urls',\n                expected='Presigned URL',\n                actual=str(e),\n                passed=False,\n                error=str(e),\n            )\n    \n    def run_all_probes(self) -> list[ProbeResult]:\n        return [\n            self.test_bucket_notifications(),\n            self.test_object_versioning(),\n            self.test_presigned_url(),\n        ]\n"
  },
  "test_files": {
    "tests/test_s3_parity.py": "\"\"\"Tests for S3 API parity.\"\"\"\nimport pytest\nfrom src.probes.s3_parity import S3ParityProbe\n\n\nclass TestS3Parity:\n    @pytest.fixture\n    def probe(self):\n        return S3ParityProbe()\n    \n    def test_bucket_notifications(self, probe):\n        result = probe.test_bucket_notifications()\n        assert result.passed, f\"Bucket notifications failed: {result.error}\"\n    \n    def test_object_versioning(self, probe):\n        result = probe.test_object_versioning()\n        assert result.passed, f\"Object versioning failed: {result.error}\"\n    \n    def test_presigned_url(self, probe):\n        result = probe.test_presigned_url()\n        assert result.passed, f\"Presigned URL failed: {result.error}\"\n"
  },
  "requirements": [
    "boto3>=1.28.0",
    "pytest>=7.0.0"
  ]
}